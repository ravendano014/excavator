<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STL App</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    #renderCanvas {
      width: 100%;
      height: 100%;
      touch-action: none;
    }
  </style>
</head>
<body>
  <canvas id="renderCanvas"></canvas>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.js"></script>
  <script>
    var canvas = document.getElementById("renderCanvas");
    var engine = new BABYLON.Engine(canvas, true);
    var scene = new BABYLON.Scene(engine);
    var camera = new BABYLON.ArcRotateCamera("camera", 1, 0.8, 10, new BABYLON.Vector3(0, 0, 0), scene);
    camera.attachControl(canvas, true);
    var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
    var jsonParts = [{
      "name": "excavator",
      "models": "https://raw.githubusercontent.com/ravendano014/excavator/main/Mesh/",
      "parts": [
        { 
        "mesh_id": "ukaq",    
        "mesh_name":"BodyLower_2_.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "akaq",
        "mesh_name":"BodyUpper_2_.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "bkaq",
        "mesh_name":"Bushing.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "ykaq",
        "mesh_name":"Cabin.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "zkaq",
        "mesh_name":"Grille.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]    
        },{
        "mesh_id": "ckaq",
        "mesh_name":"Kleinteile.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "dkaq",
        "mesh_name":"TrackBoxLeft.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "ekaq",
        "mesh_name":"TrkMdlPart.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "fkaq",
        "mesh_name":"arm0a.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "gkaq",
        "mesh_name":"arm0b.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "hkaq",
        "mesh_name":"arm1.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "ikaq",
        "mesh_name":"arm2.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "jkaq",
        "mesh_name":"armConnector.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "kkaq",
        "mesh_name":"cone.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "lkaq",
        "mesh_name":"loeffel.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "mkaq",
        "mesh_name":"powerwheel.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "nkaq",
        "mesh_name":"pwrWhlStabi.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "okaq",
        "mesh_name":"rotation_spur.STL",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "pkaq",
        "mesh_name":"servo_pinion_gear.STL",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "qkaq",
        "mesh_name":"tableLower.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "rkaq",
        "mesh_name":"trackBoxRight.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "skaq",
        "mesh_name":"trackMiddleWheels.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "tkaq",
        "mesh_name":"trackTightener.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "vkaq",
        "mesh_name":"tracks.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "wkaq",
        "mesh_name":"washerSpacer.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        },{
        "mesh_id": "xkaq",
        "mesh_name":"wireHolder.stl",
        "position": [{ "x": 0, "y": 0, "z": 0}],
        "rotation": [{ "x": 0, "y": 0, "z": 0}]
        }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    ]
}];


    // Variable para el objeto 3D seleccionado
    var selectedMesh = null;

    function createMeshFromPart(part) {
      var mesh = new BABYLON.Mesh(part.mesh_id, scene);
      var meshURL = jsonParts[0].models + part.mesh_name;

      BABYLON.SceneLoader.ImportMesh("", meshURL, "", scene, function (newMeshes) {
        mesh = newMeshes[0];
      });

      mesh.position = new BABYLON.Vector3(part.position[0].x, part.position[0].y, part.position[0].z);
      mesh.rotation = new BABYLON.Vector3(BABYLON.Tools.ToRadians(part.rotation[0].x), BABYLON.Tools.ToRadians(part.rotation[0].y), BABYLON.Tools.ToRadians(part.rotation[0].z));
      mesh.visibility = 0.5;

      mesh.isPickable = true;
      mesh.actionManager = new BABYLON.ActionManager(scene);

      return mesh;
    }

    for (var i = 0; i < jsonParts[0].parts.length; i++) {
      createMeshFromPart(jsonParts[0].parts[i]);
    }

    engine.runRenderLoop(function () {
      scene.render();
    });

    window.addEventListener("resize", function () {
      engine.resize();
    });

    let pickedMesh = null;
    scene.onPointerMove = function() {
        var result = scene.pick(scene.pointerX, scene.pointerY);
        if (result.pickedMesh !== pickedMesh) {            
            if (pickedMesh) {
                pickedMesh.disableEdgesRendering(); 
            }

            pickedMesh = result.pickedMesh;
            if (pickedMesh) {
                pickedMesh.edgesWidth = 40.0;
                pickedMesh.edgesColor = new BABYLON.Color4(0, 1, 0.87);
                pickedMesh.enableEdgesRendering();

                window.addEventListener("keydown", function (event) {
              var speed = 0.1;
              switch (event.key) {
                case "q":
                  pickedMesh.position.x += speed;
                  break;
                case "a":
                  pickedMesh.position.x -= speed;
                  break;
                case "w":
                  pickedMesh.position.y += speed;
                  break;
                case "s":
                  pickedMesh.position.y -= speed;
                  break;
                case "e":
                  pickedMesh.position.z += speed;
                  break;
                case "d":
                  pickedMesh.position.z -= speed;
                  break;
                case "r":
                  pickedMesh.rotation.x += BABYLON.Tools.ToRadians(5);
                  break;
                case "f":
                  pickedMesh.rotation.x -= BABYLON.Tools.ToRadians(5);
                  break;
                case "t":
                  pickedMesh.rotation.y += BABYLON.Tools.ToRadians(5);
                  break;
                case "g":
                  pickedMesh.rotation.y -= BABYLON.Tools.ToRadians(5);
                  break;
                case "y":
                  pickedMesh.rotation.z += BABYLON.Tools.ToRadians(5);
                  break;
                case "h":
                  pickedMesh.rotation.z -= BABYLON.Tools.ToRadians(5);
                  break;
              }
            });
            
            }
        }
    };

  </script>
</body>
</html>

